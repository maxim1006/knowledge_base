<html>
<head>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.js"></script>
	
</head>
<body>

<div id="d1" style="width:100px;height:100px;background:red;">1</div>
<div id="d2" style="width:100px;height:100px;background:green;">2</div>


	<input id="btnResolve" type="button" value="Resolve" />
	<input id="btnReject" type="button" value="Reject" />
	<input id="btnReport" type="button" value="Report State" />


<script type="text/javascript">
	//1 пример
	// var deferred = $.Deferred();

	// deferred.done(function(){console.log('resolved')});
	// deferred.fail(function(){console.log('rejected')});
		
	// $(function() {
	// 	$("#btnResolve").click(function(){ deferred.resolve(); });
	// 	$("#btnReject").click(function(){ deferred.reject(); });
	// 	$("#btnReport").click(function(){ console.log(deferred.state()); });
	// });

	//2 пример
    var a1 = $.Deferred();
    var a2 = $.Deferred();

    $('#d1').slideUp(2000, a1.resolve);
    $('#d2').slideUp(5000, a2.resolve);

    a1.done(function(){console.log('1 done');});
    a2.done(function(){console.log('2 done');});

    $.when(a1, a2).then(function(){console.log('both done');}).done(function(){setTimeout(function(){console.log(321321);}, 3000)});


	//3 пример
	// function test() {
	//     var d = $.Deferred();
	//     setTimeout(function() { d.resolve(); }, 3000);
	//     return d.promise();
	// }

	// var t = test().done(function() { alert('timeout'); });

	// // пытаемся добавить задачу уже после выполнения
	// setTimeout(function() {
	//     alert('add this after t is done');
	//     t.done(function() { alert('completed'); });
	// }, 5000);

	//4 пример
	// $(function() {
	//     var count = 0;
	//     $('.cube').on('click', function() {
	//         count++;

	//         $(this)
	//             .animate({'width': 400, 'height': 400}, 300)
	//                 .promise()
	//                     .done(function(){console.log(123);})
	//                         .then(function() {
	//                             setTimeout(function() {
	//                                 console.log(456);
	//                             }, 1000);
	//                         });

	//     });
	// });
	
	//.promise можно устанавливать на элемент, на котором есть анимации
	// $( "button" ).on( "click", function() {
	// 	  $( "p" ).append( "Started..." );
		 
	// 	  $( "div" ).each(function( i ) {
	// 	    $( this ).fadeIn().fadeOut( 1000 * ( i + 1 ) );
	// 	  });
		 
	// 	  $( "div" ).promise().done(function() {
	// 	    $( "p" ).append( " Finished! " );
	// 	  });
	// });

	//так же можно использовать when в комбинации с функциями, чтобы закончить все анимации
	// var effect = function() {
	//   return $( "div" ).fadeIn( 800 ).delay( 1200 ).fadeOut();
	// };
	 
	// $( "button" ).on( "click", function() {
	//   $( "p" ).append( " Started... " );
	 
	//   $.when( effect() ).done(function() {
	//     $( "p" ).append( " Finished! " );
	//   });
	// });

	//могу дать любой функции
	/*function fooPromise() {
	    var deferred = $.Deferred();

	    setTimeout(function() {
	        deferred.resolve("foo");
	    }, 1000);

	    return deferred.promise();
	}
	//первый - на success, второй на fail
	fooPromise().then(
	    function(value) {
	        // prints "foo" after 1 second
	        console.log(value);
	    },
	    function() { console.log("something went wrong"); }
	);*/


	//еще пример
	/*function f() {
	   var dfd = $.Deferred();

	   setTimeout(function(){dfd.resolve('did it!')}, 3000);

	   return dfd.promise();
	}

	f().done(function(data){console.log('I ' + data)});*/


    //еще пример
    // Existing object
/*    var obj = {
                hello: function( name ) {
                    alert( "Hello " + name );
                }
            },
    // Create a Deferred
            defer = $.Deferred();

    // Set object as a promise
    defer.promise( obj );

    // Resolve the deferred
    defer.resolve( "John" );

    // Use the object as a Promise
    obj.done(function( name ) {
        obj.hello( name ); // Will alert "Hello John"
    }).hello( "Karl" ); // Will alert "Hello Karl"*/



</script>	
</body>
</html>